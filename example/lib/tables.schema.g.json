{
  "accounts": {
    "columns": {
      "id": {
        "type": "text"
      },
      "first_name": {
        "type": "text"
      },
      "last_name": {
        "type": "text"
      },
      "location": {
        "type": "point"
      },
      "company_id": {
        "type": "text",
        "isNullable": true
      }
    },
    "constraints": [
      {
        "type": "primary_key",
        "column": "id"
      },
      {
        "type": "foreign_key",
        "column": "company_id",
        "target": "companies.id",
        "on_delete": "set_null",
        "on_update": "cascade"
      }
    ],
    "indexes": [],
    "views": [
      {
        "table_name": "accounts",
        "primary_key_name": "id",
        "name": "user_accounts_view",
        "columns": [
          {
            "type": "field_column",
            "column_name": "id"
          },
          {
            "type": "field_column",
            "column_name": "first_name"
          },
          {
            "type": "field_column",
            "column_name": "last_name"
          },
          {
            "type": "field_column",
            "column_name": "location"
          },
          {
            "type": "reference_column",
            "param_name": "billingAddress",
            "ref_column_name": "account_id",
            "table_name": "billing_addresses_view"
          },
          {
            "type": "foreign_column",
            "param_name": "company",
            "column_name": "company_id",
            "link_primary_key_name": "id",
            "table_name": "member_companies_view"
          },
          {
            "type": "multi_reference_column",
            "param_name": "invoices",
            "ref_column_name": "account_id",
            "link_table_name": "invoices",
            "table_name": "owner_invoices_view"
          },
          {
            "type": "join_column",
            "param_name": "parties",
            "join_table_name": "accounts_parties",
            "link_table_name": "parties",
            "parent_foreign_key_name": "account_id",
            "link_primary_key_name": "id",
            "link_foreign_key_name": "party_id",
            "table_name": "guest_parties_view"
          }
        ]
      },
      {
        "table_name": "accounts",
        "primary_key_name": "id",
        "name": "admin_accounts_view",
        "columns": [
          {
            "type": "field_column",
            "column_name": "id"
          },
          {
            "type": "field_column",
            "column_name": "first_name"
          },
          {
            "type": "field_column",
            "column_name": "last_name"
          },
          {
            "type": "field_column",
            "column_name": "location"
          },
          {
            "type": "reference_column",
            "param_name": "billingAddress",
            "ref_column_name": "account_id",
            "table_name": "billing_addresses_view"
          },
          {
            "type": "foreign_column",
            "param_name": "company",
            "column_name": "company_id",
            "link_primary_key_name": "id",
            "table_name": "member_companies_view"
          },
          {
            "type": "multi_reference_column",
            "param_name": "invoices",
            "ref_column_name": "account_id",
            "link_table_name": "invoices",
            "table_name": "owner_invoices_view"
          },
          {
            "type": "join_column",
            "param_name": "parties",
            "join_table_name": "accounts_parties",
            "link_table_name": "parties",
            "parent_foreign_key_name": "account_id",
            "link_primary_key_name": "id",
            "link_foreign_key_name": "party_id",
            "table_name": "guest_parties_view"
          }
        ]
      },
      {
        "table_name": "accounts",
        "primary_key_name": "id",
        "name": "company_accounts_view",
        "columns": [
          {
            "type": "field_column",
            "column_name": "id"
          },
          {
            "type": "field_column",
            "column_name": "first_name"
          },
          {
            "type": "field_column",
            "column_name": "last_name"
          },
          {
            "type": "field_column",
            "column_name": "location"
          },
          {
            "type": "join_column",
            "param_name": "parties",
            "join_table_name": "accounts_parties",
            "link_table_name": "parties",
            "parent_foreign_key_name": "account_id",
            "link_primary_key_name": "id",
            "link_foreign_key_name": "party_id",
            "transformer": "array_to_json(ARRAY (( SELECT * FROM jsonb_array_elements({{key}}.data) AS {{key}} WHERE ({{key}} -> 'sponsor_id') = to_jsonb ({{table}}.company_id) )) ) AS {{key}}",
            "table_name": "company_parties_view"
          }
        ]
      }
    ]
  },
  "billing_addresses": {
    "columns": {
      "account_id": {
        "type": "text",
        "isNullable": true
      },
      "company_id": {
        "type": "text",
        "isNullable": true
      },
      "name": {
        "type": "text"
      },
      "street": {
        "type": "text"
      },
      "postcode": {
        "type": "text"
      },
      "city": {
        "type": "text"
      }
    },
    "constraints": [
      {
        "type": "foreign_key",
        "column": "account_id",
        "target": "accounts.id",
        "on_delete": "cascade",
        "on_update": "cascade"
      },
      {
        "type": "foreign_key",
        "column": "company_id",
        "target": "companies.id",
        "on_delete": "cascade",
        "on_update": "cascade"
      },
      {
        "type": "unique",
        "column": "account_id"
      }
    ],
    "indexes": [],
    "views": [
      {
        "table_name": "billing_addresses",
        "primary_key_name": null,
        "name": "billing_addresses_view",
        "columns": [
          {
            "type": "field_column",
            "column_name": "name"
          },
          {
            "type": "field_column",
            "column_name": "street"
          },
          {
            "type": "field_column",
            "column_name": "postcode"
          },
          {
            "type": "field_column",
            "column_name": "city"
          }
        ]
      }
    ]
  },
  "companies": {
    "columns": {
      "id": {
        "type": "text"
      },
      "name": {
        "type": "text"
      }
    },
    "constraints": [
      {
        "type": "primary_key",
        "column": "id"
      }
    ],
    "indexes": [],
    "views": [
      {
        "table_name": "companies",
        "primary_key_name": "id",
        "name": "admin_companies_view",
        "columns": [
          {
            "type": "multi_reference_column",
            "param_name": "members",
            "ref_column_name": "company_id",
            "link_table_name": "accounts",
            "table_name": "company_accounts_view"
          },
          {
            "type": "field_column",
            "column_name": "id"
          },
          {
            "type": "field_column",
            "column_name": "name"
          },
          {
            "type": "multi_reference_column",
            "param_name": "addresses",
            "ref_column_name": "company_id",
            "link_table_name": "billing_addresses",
            "table_name": "billing_addresses_view"
          },
          {
            "type": "multi_reference_column",
            "param_name": "invoices",
            "ref_column_name": "company_id",
            "link_table_name": "invoices",
            "table_name": "owner_invoices_view"
          },
          {
            "type": "multi_reference_column",
            "param_name": "parties",
            "ref_column_name": "sponsor_id",
            "link_table_name": "parties",
            "table_name": "company_parties_view"
          }
        ]
      },
      {
        "table_name": "companies",
        "primary_key_name": "id",
        "name": "member_companies_view",
        "columns": [
          {
            "type": "field_column",
            "column_name": "id"
          },
          {
            "type": "field_column",
            "column_name": "name"
          },
          {
            "type": "multi_reference_column",
            "param_name": "addresses",
            "ref_column_name": "company_id",
            "link_table_name": "billing_addresses",
            "table_name": "billing_addresses_view"
          }
        ]
      }
    ]
  },
  "invoices": {
    "columns": {
      "account_id": {
        "type": "text",
        "isNullable": true
      },
      "company_id": {
        "type": "text",
        "isNullable": true
      },
      "id": {
        "type": "text"
      },
      "title": {
        "type": "text"
      },
      "invoice_id": {
        "type": "text"
      }
    },
    "constraints": [
      {
        "type": "primary_key",
        "column": "id"
      },
      {
        "type": "foreign_key",
        "column": "account_id",
        "target": "accounts.id",
        "on_delete": "set_null",
        "on_update": "cascade"
      },
      {
        "type": "foreign_key",
        "column": "company_id",
        "target": "companies.id",
        "on_delete": "set_null",
        "on_update": "cascade"
      }
    ],
    "indexes": [],
    "views": [
      {
        "table_name": "invoices",
        "primary_key_name": "id",
        "name": "owner_invoices_view",
        "columns": [
          {
            "type": "field_column",
            "column_name": "id"
          },
          {
            "type": "field_column",
            "column_name": "title"
          },
          {
            "type": "field_column",
            "column_name": "invoice_id"
          }
        ]
      }
    ]
  },
  "parties": {
    "columns": {
      "sponsor_id": {
        "type": "text",
        "isNullable": true
      },
      "id": {
        "type": "text"
      },
      "name": {
        "type": "text"
      },
      "date": {
        "type": "int8"
      }
    },
    "constraints": [
      {
        "type": "primary_key",
        "column": "id"
      },
      {
        "type": "foreign_key",
        "column": "sponsor_id",
        "target": "companies.id",
        "on_delete": "set_null",
        "on_update": "cascade"
      }
    ],
    "indexes": [],
    "views": [
      {
        "table_name": "parties",
        "primary_key_name": "id",
        "name": "guest_parties_view",
        "columns": [
          {
            "type": "foreign_column",
            "param_name": "sponsor",
            "column_name": "sponsor_id",
            "link_primary_key_name": "id",
            "table_name": "member_companies_view"
          },
          {
            "type": "field_column",
            "column_name": "id"
          },
          {
            "type": "field_column",
            "column_name": "name"
          },
          {
            "type": "field_column",
            "column_name": "date"
          }
        ]
      },
      {
        "table_name": "parties",
        "primary_key_name": "id",
        "name": "company_parties_view",
        "columns": [
          {
            "type": "field_column",
            "column_name": "id"
          },
          {
            "type": "field_column",
            "column_name": "name"
          },
          {
            "type": "field_column",
            "column_name": "date"
          }
        ]
      }
    ]
  },
  "accounts_parties": {
    "columns": {
      "account_id": {
        "type": "text"
      },
      "party_id": {
        "type": "text"
      }
    },
    "constraints": [
      {
        "type": "primary_key",
        "column": "account_id\", \"party_id"
      },
      {
        "type": "foreign_key",
        "column": "account_id",
        "target": "accounts.id",
        "on_delete": "cascade",
        "on_update": "cascade"
      },
      {
        "type": "foreign_key",
        "column": "party_id",
        "target": "parties.id",
        "on_delete": "cascade",
        "on_update": "cascade"
      }
    ]
  }
}